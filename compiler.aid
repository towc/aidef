compiler {
  path=src/compiler;
  
  Compiles .aid files into an execution plan.
  
  Exports a compile function that takes rootFile, outputDir, and apiKey.
  First runs the resolver, then the llmCompiler.

  parser {
    path=src/compiler/parser.ts;
    
    Deterministic parser for .aid syntax. No LLM involved.
    
    Exports parse and stringify functions, plus type definitions for the AST nodes:
    AidNode (union of Module, Param, Include, Prose), and each of those interfaces.

    Syntax rules:
      - include path; is an include directive
      - name { content } is a module block  
      - name=value; is a parameter
      - everything else is prose
      - code blocks (triple backticks) are opaque prose, not parsed inside
  }

  resolver {
    path=src/compiler/resolver.ts;

    Deterministic pre-processing. Resolves all includes into a single file.
    
    Exports a resolve function that takes rootFile and outputDir.
    Uses the parser to parse, recursively inlines includes, writes output.
  }

  llmCompiler {
    path=src/compiler/llmCompiler.ts;

    LLM-powered compilation of resolved .aid into execution plan.
    
    Exports a compileNode function that takes the resolved aid path and apiKey.
    
    Uses Gemini with function calling. Provides gen_node and gen_leaf tools.
    Each node acts as architect, identifying submodules and spawning children.
    Passes relevant sibling context when spawning.
    Temperature=0 for deterministic output.
  }

  treeDiff {
    path=src/compiler/treeDiff.ts;

    Caching via content hashing to skip unchanged subtrees.
    
    Exports functions for hashing content, loading/saving previous hashes, and pruning branches.
  }
}
